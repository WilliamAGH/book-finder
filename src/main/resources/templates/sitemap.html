<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
      th:with="
        sitemapTitle=${pageTitle ?: 'Sitemap'},
        sitemapDescription=${pageDescription ?: 'Explore all indexed book and author pages.'},
        canonicalUrl=${canonicalUrl != null && !#strings.isEmpty(canonicalUrl) ? canonicalUrl : (#httpServletRequest != null ? #httpServletRequest.requestURL.toString() : '')}
      ">
<head th:replace="~{fragments/layout :: head(title=${sitemapTitle}, description=${sitemapDescription}, canonicalUrl=${canonicalUrl}, ogImage=@{/images/og-logo.png}, keywords='book sitemap, author sitemap, find my book')}">
    <meta charset="UTF-8">
</head>
<body class="modern-layout">
<nav th:replace="~{fragments/layout :: navbar}"></nav>

<main class="main-content modern-main-content py-4">
    <div class="container">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4 gap-3">
            <div>
                <h1 class="mb-1">Site Index</h1>
                <p class="text-muted mb-0">Server-rendered directory of books and authors for search engines and readers.</p>
            </div>
            <div class="btn-group" role="group" aria-label="Sitemap view selector">
                <a th:href="@{|/sitemap/authors/${activeLetter}/1|}"
                   th:class="${viewType == 'authors'} ? 'btn btn-primary' : 'btn btn-outline-primary'">
                    Authors &amp; Books
                </a>
                <a th:href="@{|/sitemap/books/${activeLetter}/1|}"
                   th:class="${viewType == 'books'} ? 'btn btn-primary' : 'btn btn-outline-primary'">
                    Books Only
                </a>
            </div>
        </div>

        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    <span class="text-uppercase fw-semibold small text-muted">Jump to letter:</span>
                    <a th:each="letter : ${letters}"
                       th:href="@{|/sitemap/${viewType}/${letter}/1|}"
                       th:text="${letter}"
                       th:class="${letter == activeLetter} ? 'badge bg-primary text-decoration-none' : 'badge bg-light text-dark text-decoration-none'"></a>
                </div>
            </div>
        </div>

        <div th:if="${viewType == 'books'}" class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h2 class="h5 mb-0">Books starting with '<span th:text="${activeLetter}"></span>'</h2>
                <p class="small text-muted mb-0" th:text="${totalItems} + ' titles indexed'">0 titles indexed</p>
            </div>
            <div class="card-body">
                <div th:if="${books != null && !books.isEmpty()}" class="row row-cols-1 row-cols-md-2 g-3">
                    <div class="col" th:each="book : ${books}">
                        <div class="border rounded p-3 h-100">
                            <h3 class="h6 mb-1">
                                <a th:href="@{'/book/' + ${book.slug}}" class="text-decoration-none">
                                    <span th:text="${book.title}">Book Title</span>
                                </a>
                            </h3>
                            <p class="small text-muted mb-0">
                                Last updated: <span th:text="${#temporals.format(book.updatedAt, 'yyyy-MM-dd')}">2024-01-01</span>
                            </p>
                        </div>
                    </div>
                </div>
                <div th:if="${books == null || books.isEmpty()}" class="alert alert-info mb-0" role="alert">
                    No books found for this letter yet.
                </div>
            </div>
        </div>

        <div th:if="${viewType == 'authors'}" class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h2 class="h5 mb-0">Authors starting with '<span th:text="${activeLetter}"></span>'</h2>
                <p class="small text-muted mb-0" th:text="${totalItems} + ' authors indexed'">0 authors indexed</p>
            </div>
            <div class="card-body">
                <div th:if="${authors != null && !authors.isEmpty()}" class="accordion" id="authorAccordion">
                    <div class="accordion-item" th:each="author, iterStat : ${authors}">
                        <h3 class="accordion-header" th:attr="id='author-' + ${author.authorId}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    th:attr="data-bs-target='#collapse-' + ${author.authorId}"
                                    aria-expanded="false"
                                    th:attrappend=" aria-controls='collapse-' + ${author.authorId}">
                                <span th:text="${author.authorName}">Author Name</span>
                                <span class="badge bg-light text-dark ms-3" th:text="${author.books != null ? author.books.size() : 0} + ' titles'">0 titles</span>
                            </button>
                        </h3>
                        <div class="accordion-collapse collapse"
                             th:classappend="${iterStat.index == 0} ? ' show' : ''"
                             th:attr="id='collapse-' + ${author.authorId}"
                             th:attrappend=" aria-labelledby='author-' + ${author.authorId}" data-bs-parent="#authorAccordion">
                            <div class="accordion-body">
                                <div th:if="${author.books != null && !author.books.isEmpty()}">
                                    <ul class="list-unstyled mb-0">
                                        <li th:each="book : ${author.books}" class="mb-1">
                                            <a th:href="@{'/book/' + ${book.slug}}" class="text-decoration-none">
                                                <span th:text="${book.title}">Book Title</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div th:if="${author.books == null || author.books.isEmpty()}" class="text-muted small">
                                    No indexed titles for this author yet.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:if="${authors == null || authors.isEmpty()}" class="alert alert-info mb-0" role="alert">
                    No authors found for this letter yet.
                </div>
            </div>
        </div>

        <nav th:if="${totalPages != null && totalPages > 1}" aria-label="Pagination">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${pageNumber == 1} ? ' disabled' : ''">
                    <a class="page-link"
                       th:href="@{/sitemap(view=${viewType}, letter=${activeLetter}, page=${pageNumber - 1})}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                    th:classappend="${i == pageNumber} ? ' active' : ''">
                    <a class="page-link"
                       th:href="@{/sitemap(view=${viewType}, letter=${activeLetter}, page=${i})}"
                       th:text="${i}">1</a>
                </li>
                <li class="page-item" th:classappend="${pageNumber == totalPages} ? ' disabled' : ''">
                    <a class="page-link"
                       th:href="@{/sitemap(view=${viewType}, letter=${activeLetter}, page=${pageNumber + 1})}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="alert alert-secondary small" role="alert">
            XML versions of this sitemap are available at
            <a th:href="${baseUrl + '/sitemap.xml'}" class="text-decoration-none">[[${baseUrl}]]/sitemap.xml</a>.
        </div>
    </div>
</main>

<footer th:replace="~{fragments/layout :: footer}"></footer>
<th:block th:replace="~{fragments/layout :: scripts}"></th:block>
</body>
</html>
